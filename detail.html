<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Book Details</title>




<style>
/* تنظیمات پایه برای بدنه صفحه */
.page-body {
  background-color: #e8e8e8;
  font-family: modam, sans-serif;
  justify-content: center;
  align-items: center;
  min-height: 100vh;

}

/* استایل کانتینر اصلی جزئیات کتاب */
.book-detail-container {
  max-width: 1024px; /* معادل max-w-4xl در Tailwind */
  width: 100%;
  padding: 1.5rem; /* معادل p-6 */
  background-color: #ffffff;
  border-radius: 0.5rem; /* معادل rounded-lg */
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  margin: 0 1rem; /* معادل mx-4 */
  margin: 10px auto;
  direction: rtl;
}

/* استایل خطا */
.error-text {
  color: #e3342f;
  text-align: center;
}

/* ساختار فلکسی برای جزئیات کتاب */
.book-detail-flex {
  display: flex;
  flex-direction: column;
}

@media (min-width: 768px) {
  .book-detail-flex {
    flex-direction: row;
  }
}

/* استایل بخش تصویر کتاب */
.book-image-container {
  width: 100%;
  max-width: 33.33%; /* برای دسکتاپ: یک‌سوم عرض */
  display: flex;
  justify-content: center;
  align-items: center;
}

.book-image {
  width: 220px; /* معادل w-48 */
  height: auto;
  border-radius: 0.5rem; /* rounded-lg */
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

/* استایل بخش اطلاعات کتاب */
.book-info-container {
  width: 100%;
  max-width: 66.66%; /* برای دسکتاپ: دو‌سوم عرض */
  margin-top: 1rem;
}

@media (min-width: 768px) {
  .book-info-container {
    margin-top: 0;
    margin-left: 1.5rem; /* معادل md:ml-6 */
  }
}

.book-title {
  font-size: 1.5rem; /* معادل text-2xl */
  font-weight: bold;
  color: #2d3748; /* معادل text-gray-800 */
}

.book-info {
  color: #718096; /* معادل text-gray-600 */
  margin-top: 0.5rem;
  font-size: 1rem;
}

.book-price {
  color: #38a169; /* معادل text-green-600 */
  font-weight: bold;
  margin-top: 0.5rem;
  font-size: 1rem;
}

.book-rating {
  color: #d69e2e; /* معادل text-yellow-500 */
  font-size: 1rem;
  margin-top: 0.5rem;
}

/* استایل دکمه خرید */
.buy-button {
  width: 180px;
  height: 40px;
  background-color: transparent;
  color: green;
  font-family: modam, sans-serif;
  padding: 5px 10px;
  margin-top: 1rem;
  margin-bottom: 1.25rem;
  border: 1px dashed green;
  border-radius: 0.3125rem; /* معادل rounded */
  transition: background-color 0.2s ease, color 0.2s ease;
  cursor: pointer;
}

.buy-button:hover {
  background-color: green;
  color: #e8e8e8;
}

/* استایل بخش توضیحات کتاب */
.book-description {
  margin-top: 1.5rem;
  border-top: 1px solid #e2e8f0;
  padding-top: 1rem;
}

.description-title {
  font-size: 1.125rem; /* معادل text-lg */
  font-weight: bold;
  margin-bottom: 0.5rem;
}

.description-text {
  color: #4a5568; /* معادل text-gray-700 */
  font-size: 1rem;
}

/* استایل لینک بازگشت */
.back-link {
  display: inline-block;
  margin-top: 1.5rem;
  color: #3182ce; /* معادل text-blue-600 */
  text-decoration: none;
  transition: color 0.2s ease;
}

.back-link:hover {
  color: #2b6cb0; /* معادل hover:text-blue-800 */
}

/* تنظیمات اضافی برای موبایل */
@media (max-width: 767px) {
  /* در موبایل، تصویر کامل عرض شود */
  .book-image-container {
    max-width: 100%;
  }
  
  .book-image {
    width: 30%;
    border-radius: 0; /* در صورت تمایل، می‌توانید حاشیه‌های گرد را حذف کنید */

  }

  @media (max-width: 480px) {
  /* در موبایل، تصویر کامل عرض شود */
  .book-image-container {
    max-width: 100%;
  }
  
  .book-image {
    width: 50%;
    border-radius: 0; /* در صورت تمایل، می‌توانید حاشیه‌های گرد را حذف کنید */

  }
  .buy-button {
  width: 80%;

}
  
  /* فاصله‌های اضافی برای بخش اطلاعات کتاب */
  .book-info-container {
    margin-left: 0;
    margin-top: 1rem;
    text-align: center;
    margin: 10px auto;
  }
  .book-title {
    text-align: center;

  }
}
}



</style>


<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Book Details</title>
  
  <!-- استفاده از Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- اسکریپت‌های شما -->
  <script src="library/script1.js"></script>
  
  <!-- فایل CSS اختصاصی -->
  <link rel="stylesheet" href="style.css" />
  
  <!-- آیکون‌ها -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />
  
  <!-- استایل Swiper (در صورت استفاده) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
</head>
<body class="page-body">
  <!-- محل نمایش جزئیات کتاب -->
  <div id="book-detail-section" class="book-detail-container"></div>

  <script>
    // گرفتن آیدی کتاب از URL
    const urlParams = new URLSearchParams(window.location.search);
    const bookId = urlParams.get('id');

    if (!bookId) {
      document.getElementById('book-detail-section').innerHTML = '<p class="error-text">آیدی کتاب پیدا نشد.</p>';
    }

    // دریافت توکن از localStorage
    const accessToken = localStorage.getItem('access_token');

    if (!accessToken) {
      alert('توکن یافت نشد! لطفاً وارد شوید.');
      window.location.href = '/login.html';
    }

    // تابع دریافت و نمایش جزئیات کتاب
    async function fetchBookDetail() {
      try {
        const response = await fetch(`http://localhost:8000/books/detail/${bookId}/`, {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${accessToken}`,
            'Content-Type': 'application/json',
          }
        });

        if (response.ok) {
          const data = await response.json();
          const bookDetailContainer = document.getElementById('book-detail-section');

          // قرار دادن اطلاعات کتاب در صفحه
          bookDetailContainer.innerHTML = `
            <div class="book-detail-flex">
              <!-- بخش تصویر کتاب -->
              <div class="book-image-container">
                <img src="http://localhost:8000${data.data.cover_image || '/images/default-book-cover.jpg'}" 
                     alt="${data.data.title}" 
                     class="book-image">
              </div>
              <!-- بخش اطلاعات کتاب -->
              <div id="content-top" class="book-info-container">
                <h1 class="book-title">${data.data.title}</h1>
                <p class="book-info">

<strong>نویسنده:</strong> 
${data.data.authors.map(author => 
    `<a href="authors.html?id=${author.id}">
        ${author.first_name} ${author.last_name}
    </a>`
).join(', ') || 'نامشخص'}


<p class="book-info">
  <strong>مترجم:</strong> 
  ${data.data.translators.length > 0 
    ? data.data.translators.map(translator => 
        `<a href="translator.html?id=${translator.id || ''}">
          ${translator.first_name} ${translator.last_name}
        </a>`
      ).join(', ') 
    : 'ندارد'}
</p>



<p class="book-info">
  <strong>ناشر:</strong> 
  <a href="publisher.html?id=${data.data.publisher.id || ''}">
    ${data.data.publisher.name || 'نامشخص'}
  </a>
</p>


                <p class="book-info">
                  <strong>تعداد صفحات:</strong> ${data.data.page_count || 'نامشخص'}
                </p>
                <p class="book-price">
                  <strong>قیمت:</strong> ${data.data.price} تومان
                </p>
                <p class="book-rating">
                  <strong>امتیاز:</strong> ${data.data.rating} از ۵
                </p>
                  <button id="buybutton" onclick="handleBuyClick('${data.data.id}')" class="buy-button">
                    افزودن به سبد خرید
                  </button>
              </div>
            </div>
            <!-- خلاصه کتاب -->
            <div id="description" class="book-description">
              <h2 class="description-title">خلاصه کتاب و توضیحات</h2>
              <p class="description-text">${data.data.summary || 'خلاصه‌ای برای این کتاب موجود نیست.'}</p>
            </div>
            <a href="index.html" class="back-link">بازگشت به لیست کتاب‌ها</a>
          `;
        } else {
          const errorData = await response.json();
          document.getElementById('book-detail-section').innerHTML = `<p class="error-text">خطا: ${errorData.message}</p>`;
        }
      } catch (error) {
        document.getElementById('book-detail-section').innerHTML = '<p class="error-text">خطا در ارسال درخواست. لطفاً دوباره تلاش کنید.</p>';
      }
    }


    function isUserLoggedIn() {
    // بررسی اینکه آیا توکن کاربر در localStorage هست یا نه
    return localStorage.getItem('userToken') !== null;
  }

  function redirectToLogin() {
    // ذخیره صفحه فعلی برای بازگشت بعد از ورود
    localStorage.setItem('redirectAfterLogin', window.location.href);
    window.location.href = "/register.html"; // تغییر به آدرس صفحه ورود
  }

  function addToCart(productId) {
    // دریافت توکن کاربر برای ارسال درخواست به API
    const token = localStorage.getItem('userToken');
    
    fetch('/api/cart/add', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}` // ارسال توکن برای احراز هویت
      },
      body: JSON.stringify({ productId: productId })
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        alert('محصول با موفقیت به سبد خرید اضافه شد!');
      } else {
        alert('مشکلی پیش آمد، دوباره تلاش کنید.');
      }
    })
    .catch(error => {
      console.error('خطا در افزودن به سبد خرید:', error);
    });
  }

  function handleBuyClick(productId) {
    if (isUserLoggedIn()) {
      addToCart(productId);
    } else {
      redirectToLogin();
    }
  }

  // در صورت ورود موفق، به صفحه قبلی بازگردد
  window.addEventListener('load', function () {
    const redirectUrl = localStorage.getItem('redirectAfterLogin');
    if (redirectUrl) {
      localStorage.removeItem('redirectAfterLogin');
      window.location.href = redirectUrl;
    }
  });

    

    // فراخوانی تابع برای دریافت جزئیات کتاب
    fetchBookDetail();
  </script>

<script src="header.js" defer></script>


<div id="footer"></div>
<script src="footer.js"></script>


</body>
</html>
