        <!DOCTYPE html>
    <html lang="fa">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="library/script1.js"></script>
        <link rel="stylesheet" href="css/everybook.css">
        <script src="header.js"></script>
        <title> همه کتاب ها</title>

        <style>

</style>




</head>

<div class="everybook-banner"><img src="image/slide5.jpg" alt="بنر"></div>

<body>

    <div class="sort-container">
        <select id="sort">
            <option value="newest">مرتب سازی</option>
            <option value="cheap">ارزان‌ترین‌ها</option>
            <option value="expensive">گران‌ترین‌ها</option>
        </select>
    
        <select id="publisher">
            <option value="none">انتخاب انتشارات</option>
            <option value="all">همه نشرها</option>
        </select>
    </div>
    
    <div class="books-container">
        <!-- داده‌های محصولات اینجا اضافه می‌شود -->
    </div>
    
    <div class="pagination">
        <button id="prevPage" disabled>صفحه قبل</button>
        <span id="pageInfo">صفحه 1 از 1</span>
        <button id="nextPage">صفحه بعد</button>
    </div>
    
    <script>
        document.addEventListener("DOMContentLoaded", async function () {
            const booksApiUrl = "http://127.0.0.1:8000/books/";  
            const publishersApiUrl = "http://127.0.0.1:8000/publishers/";  
            const booksContainer = document.querySelector(".books-container");
            const sortSelect = document.getElementById("sort");
            const publisherSelect = document.getElementById("publisher");
            const prevPageBtn = document.getElementById("prevPage");
            const nextPageBtn = document.getElementById("nextPage");
            const pageInfo = document.getElementById("pageInfo");
    
            let allBooks = [];  
            let filteredBooks = [];  
            let publishers = [];  
            let currentPage = 1;  
            const booksPerPage = 6;  
    
            // دریافت کتاب‌ها
            async function fetchBooks() {
                try {
                    const response = await fetch(booksApiUrl);
                    allBooks = await response.json();
                    filteredBooks = [...allBooks]; 
                    renderBooks();
                } catch (error) {
                    console.error("❌ خطا در دریافت کتاب‌ها:", error);
                }
            }
    
            // دریافت ناشران
            async function fetchPublishers() {
                try {
                    const response = await fetch(publishersApiUrl);
                    publishers = await response.json();
    
                    publishers.forEach(publisher => {
                        const option = document.createElement("option");
                        option.value = publisher.id;
                        option.textContent = publisher.name;
                        publisherSelect.appendChild(option);
                    });
                } catch (error) {
                    console.error("❌ خطا در دریافت ناشران:", error);
                }
            }
    
            // نمایش کتاب‌ها با صفحه‌بندی
            function renderBooks() {
                booksContainer.innerHTML = "";  
                const startIndex = (currentPage - 1) * booksPerPage;
                const endIndex = startIndex + booksPerPage;
                const booksToShow = filteredBooks.slice(startIndex, endIndex);
    
                booksToShow.forEach(book => {
                    const bookCard = `
                        <div class="product-card">
                            <img src="${book.cover_image}" alt="${book.title}">
                            <p id="discount">${book.discount ? book.discount + " %" : "بوکیتو"}</p>
                            <p>${book.price} تومان</p>
                            <a href="detail.html?id=${book.id}" class="view-details">مشاهده جزئیات</a>
                        </div>
                    `;
                    booksContainer.innerHTML += bookCard;
                });
    
                updatePagination();
            }
    
            // فیلتر کردن کتاب‌ها بر اساس ناشر
            function filterBooks() {
                const selectedPublisher = publisherSelect.value;
                if (selectedPublisher === "all") {
                    filteredBooks = [...allBooks];
                } else {
                    filteredBooks = allBooks.filter(book => book.publisher.id == selectedPublisher);
                }
                currentPage = 1;  
                sortBooks();
            }
    
            // مرتب‌سازی کتاب‌ها
            function sortBooks() {
                const sortBy = sortSelect.value;
                if (sortBy === "cheap") {
                    filteredBooks.sort((a, b) => a.price - b.price);
                } else if (sortBy === "expensive") {
                    filteredBooks.sort((a, b) => b.price - a.price);
                } else if (sortBy === "newest") {
                    filteredBooks.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                }
                renderBooks();
            }
    
            // به‌روزرسانی وضعیت صفحه‌بندی
            function updatePagination() {
                const totalPages = Math.ceil(filteredBooks.length / booksPerPage);
                pageInfo.textContent = `صفحه ${currentPage} از ${totalPages}`;
    
                prevPageBtn.disabled = currentPage === 1;
                nextPageBtn.disabled = currentPage === totalPages;
            }
    
            // تغییر صفحه
            function changePage(step) {
                currentPage += step;
                renderBooks();
            }
    
            // افزودن Event Listener برای فیلتر، مرتب‌سازی و صفحه‌بندی
            sortSelect.addEventListener("change", sortBooks);
            publisherSelect.addEventListener("change", filterBooks);
            prevPageBtn.addEventListener("click", () => changePage(-1));
            nextPageBtn.addEventListener("click", () => changePage(1));
    
            // اجرای درخواست‌ها
            await fetchPublishers();
            await fetchBooks();
        });
    </script>
    
    

    


</body>

    <div id="footer"></div>
    <script src="footer.js"></script>
</html>
